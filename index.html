<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Interactive Text — audio or definition</title>
<style>
  body { font-family: "Hiragino Kaku Gothic ProN", "Yu Gothic", "Noto Sans JP", sans-serif; }
  body { font-family: system-ui, sans-serif; padding: 20px; line-height:1.6; }
  .word { cursor: pointer; padding: 2px 4px; border-radius: 4px; }
  .word.audio { color: #0066cc; text-decoration: underline; }
  .word.define { color: #ff6600; text-decoration: underline dotted; }
  .word.both { color: #2b7cff; text-decoration: underline; font-weight:600; }
  .word:focus { outline: 3px solid #aaa; }
  .playing { background: rgba(43,124,255,0.08); }
  /* Popup styling */
  .popup { position: fixed; inset: 0; display: none; align-items:center; justify-content:center; background: rgba(0,0,0,0.45); z-index:1000; }
  .popup-content { background: white; max-width: 460px; width: 92%; padding: 18px; border-radius: 10px; box-shadow: 0 8px 30px rgba(0,0,0,0.25); text-align:left; position:relative; }
  .popup img { max-width:100%; height:auto; margin-top:10px; border-radius:6px; display:block; }
  .close-btn { position:absolute; top:8px; right:10px; font-size:20px; cursor:pointer; border:none; background:transparent; }
  .controls { margin-top: 12px; color:#444; font-size:0.95rem; }
</style>
</head>
<body>

<h2>おじぎ</h2>

<p>
  <!-- Examples: specify action + (for audio) data-audio + (for define) data-key -->
ミッシェルは、今日本に<span class="word audio" data-action="audio" data-audio="audio/ryuugaku.mp3">留学</span>しています。ホームステイをしていて、毎日<span class="word audio" data-action="audio" data-audio="audio/densha.mp3">電車</span>で大学に行っているので、日本のいろいろな<span class="word audio" data-action="audio" data-audio="audio/shyuukan.mp3">習慣</span>がわかってきました。ミッシェルが<span class="word audio" data-action="audio" data-audio="audio/ichiban.mp3">一番</span>おもしろいと思う<span class="word audio" data-action="audio" data-audio="audio/shyuukan.mp3">習慣</span>は、<span class="word define" data-action="define" data-key="おじぎ">おじぎ</span>です。<span class="word audio" data-action="audio" data-audio="audio/kazoku.mp3">家族</span>どうしが<span class="word define" data-action="define" data-key="おじぎ">おじぎ</span>をすることはありませんが、<span class="word define" data-action="define" data-key="げんかん">げんかん</span>にお<span class="word audio" data-action="audio" data-audio="audio/kyaku.mp3">客</span>さんが来たら、<span class="word define" data-action="define" data-key="おじぎ">おじぎ</span>をします。<span class="word audio" data-action="audio" data-audio="audio/soto.mp3">外</span>で<span class="word audio" data-action="audio" data-audio="audio/kinjyo.mp3">近所</span>の人に<span class="word audio" data-action="audio" data-audio="audio/atta.mp3">会った</span>時も<span class="word define" data-action="define" data-key="おじぎ">おじぎ</span>をします。大学のキャンパスで先生に会って、<span class="word define" data-action="define" data-key="おじぎ">おじぎ</span>をしないのは、とても<span class="word audio" data-action="audio" data-audio="audio/shitsuree.mp3">失礼</span>です。とてもおかしいのは、<span class="word define" data-action="define" data-key="こうしゅう電話">こうしゅう電話</span>で話している人が、電話で話している人に「どうもすみません」とか「どうもありがとうございました」などと言って、<span class="word define" data-action="define" data-key="おじぎ">おじぎ</span>をすることです。
</p>
<p>
ミッシェルは、おじぎのことをもっとよく知りたいと思って、大学の<span class="word audio" data-action="audio" data-audio="audio/toshokan.mp3">図書館</span>で日本人の<span class="word audio" data-action="audio" data-audio="audio/shyuukan.mp3">習慣</span>を<span class="word audio" data-action="audio" data-audio="audio/setsumee.mp3">説明</span>している本を<span class="word audio" data-action="audio" data-audio="audio/karite.mp3">借りて</span>、おじぎについて読んでみました。本を読んで、<span class="word audio" data-action="audio" data-audio="audio/tsugi.mp3">次</span>のことがわかりました。まず、<span class="word audio" data-action="audio" data-audio="audio/meue.mp3">目上</span>の人と<span class="word audio" data-action="audio" data-audio="audio/meshita.mp3">目下</span>の人が<span class="word audio" data-action="audio" data-audio="audio/atta.mp3">会った</span>時、<span class="word audio" data-action="audio" data-audio="audio/meshita.mp3">目下</span>の人のほうが<span class="word audio" data-action="audio" data-audio="audio/hukai.mp3">深い</span>おじぎをしなくてはいけません。<span class="word audio" data-action="audio" data-audio="audio/jyosee.mp3">女性</span>と<span class="word audio" data-action="audio" data-audio="audio/dansee.mp3">男性</span>では、ふつう<span class="word audio" data-action="audio" data-audio="audio/jyosee.mp3">女性</span>のほうが<span class="word audio" data-action="audio" data-audio="audio/hukai.mp3">深い</span>おじぎをします。それから、おじぎは<span class="word audio" data-action="audio" data-audio="audio/chikaku.mp3">近く</span>にいる人だけにするものではありません。<span class="word audio" data-action="audio" data-audio="audio/tooku.mp3">遠く</span>に知っている人を見て、その人が友だちだったら、<span class="word define" data-action="define" data-key="手をふる">手をふる</span>だけでいいですが、その人が<span class="word audio" data-action="audio" data-audio="audio/meue.mp3">目上</span>の人だったら、<span class="word define" data-action="define" data-key="手をふる">手をふる</span>のではなくて、<span class="word audio" data-action="audio" data-audio="audio/atama.mp3">頭</span>を<span class="word audio" data-action="audio" data-audio="audio/sukoshi.mp3">少し</span><span class="word audio" data-action="audio" data-audio="audio/sageta.mp3">下げた</span>ほうがいいです。
</p>
<p>
その本を読んでから、ミッシェルは『ローマでは、ローマ人がするようにしなさい（<span class="word audio" data-action="audio" data-audio="audio/goo.mp3">郷</span>に<span class="word audio" data-action="audio" data-audio="audio/itte.mp3">入って</span>は<span class="word audio" data-action="audio" data-audio="audio/goo.mp3">郷</span>にしたがえ）When in Rome, do as the Romans do.』という<span class="word define" data-action="define" data-key="ことわざ">ことわざ</span>を<span class="word audio" data-action="audio" data-audio="audio/omoidashite.mp3">思い出して</span>、日本人のようにおじぎをすることにしました。
</p>

<div class="controls">
  Use Tab to focus a word and press Enter/Space to activate. Words colored blue = audio, orange = definition, blue+bold = both.
</div>

<!-- Popup for definitions -->
<div class="popup" id="popup" aria-hidden="true">
  <div class="popup-content" role="dialog" aria-modal="true" aria-labelledby="popup-title">
    <button class="close-btn" id="closePopup" aria-label="Close">&times;</button>
    <h2 id="popup-title"></h2>
    <p id="popup-definition"></p>
    <img id="popup-image" src="" alt="" />
  </div>
</div>

<script>
/* ---------- Data: definitions + image paths ---------- */
/* Add entries for words you want definitions for. Key should match data-key on <span>. */
const dictionary = {
  "おじぎ": {
    word: "おじぎ",
    definition: "Bowing.",
    image: "images/ojigi.jpg"
  },
  "こうしゅう電話": {
    word: "こうしゅう電話",
    definition: "Pay phone.",
    image: "images/denwa.jpg"
  },
  "ことわざ": {
    word: "ことわざ",
    definition: "Proverb.",
    image: "images/kotowaza.jpg"
  },
  "手をふる": {
    word: "手をふる",
    definition: "To wave.",
    image: "images/teohuru.jpg"
  },
  "げんかん": {
    word: "げんかん",
    definition: "Front door.",
    image: "images/genkan.jpg"
}
};
/* ---------------------------------------------------- */

/* Utility: Stop all playing audio and remove playing highlight */
function stopAllPlaying() {
  document.querySelectorAll('.word.playing').forEach(el => el.classList.remove('playing'));
  // Pause any audio objects stored on elements
  document.querySelectorAll('.word').forEach(el => {
    if (el._audio) {
      try { el._audio.pause(); el._audio.currentTime = 0; } catch(e) {}
    }
  });
}

/* Handle popup (definition + image) */
const popup = document.getElementById('popup');
const popupTitle = document.getElementById('popup-title');
const popupDefinition = document.getElementById('popup-definition');
const popupImage = document.getElementById('popup-image');
const closePopup = document.getElementById('closePopup');

function showPopup(key) {
  const entry = dictionary[key];
  if (!entry) return;
  popupTitle.textContent = entry.word;
  popupDefinition.textContent = entry.definition;
  popupImage.src = entry.image || "";
  popupImage.alt = entry.image ? `Image illustrating ${entry.word}` : "";
  popup.style.display = 'flex';
  popup.setAttribute('aria-hidden', 'false');
  // trap focus to close button for simple accessibility
  closePopup.focus();
}
function hidePopup() {
  popup.style.display = 'none';
  popup.setAttribute('aria-hidden', 'true');
}

/* Close handlers */
closePopup.addEventListener('click', hidePopup);
popup.addEventListener('click', (e) => {
  if (e.target === popup) hidePopup(); // click outside content
});
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') hidePopup();
});

/* Main: wire up word elements */
document.querySelectorAll('.word').forEach(elem => {
  const action = elem.dataset.action || "";
  // Preload audio only if audio provided
  if ((action === 'audio' || action === 'both') && elem.dataset.audio) {
    const a = new Audio(elem.dataset.audio);
    elem._audio = a;
  }

  function activate() {
    const a = elem._audio;
    const key = (elem.dataset.key || "").toLowerCase();

    // If both or audio -> play audio
    if ((action === 'audio' || action === 'both') && a) {
      stopAllPlaying();
      elem.classList.add('playing');
      a.currentTime = 0;
      a.play().catch(err => { console.warn("audio play failed:", err); });
      a.onended = () => elem.classList.remove('playing');
    }

    // If define or both -> show popup if entry exists; else optional fallback
    if ((action === 'define' || action === 'both') && key) {
      if (dictionary[key]) {
        showPopup(key);
      } else {
        // Fallback: try browser TTS to read a short message
        const msg = `${key}. Definition not available.`;
        if ('speechSynthesis' in window) {
          speechSynthesis.cancel();
          const ut = new SpeechSynthesisUtterance(msg);
          speechSynthesis.speak(ut);
        } else {
          alert(msg);
        }
      }
    }
  }

  // click handler
  elem.addEventListener('click', activate);

  // keyboard activation (Enter or Space)
  elem.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      activate();
    }
  });
});

/* Accessibility: ensure focus outline on click for mouse users */
document.addEventListener('mousedown', () => {
  document.body.classList.add('using-mouse');
});
document.addEventListener('keydown', () => {
  document.body.classList.remove('using-mouse');
});
</script>
</body>
</html>
