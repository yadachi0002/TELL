<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Interactive Text — audio or definition</title>
<style>
  body { font-family: "Hiragino Kaku Gothic ProN", "Yu Gothic", "Noto Sans JP", sans-serif; }
  body { font-family: system-ui, sans-serif; padding: 20px; line-height:1.6; }
  .word { cursor: pointer; padding: 2px 4px; border-radius: 4px; }
  .word.audio { color: #0066cc; text-decoration: underline; }
  .word.define { color: #ff6600; text-decoration: underline dotted; }
  .word.both { color: #2b7cff; text-decoration: underline; font-weight:600; }
  .word:focus { outline: 3px solid #aaa; }
  .playing { background: rgba(43,124,255,0.08); }
  /* Popup styling */
  .popup { position: fixed; inset: 0; display: none; align-items:center; justify-content:center; background: rgba(0,0,0,0.45); z-index:1000; }
  .popup-content { background: white; max-width: 460px; width: 92%; padding: 18px; border-radius: 10px; box-shadow: 0 8px 30px rgba(0,0,0,0.25); text-align:left; position:relative; }
  .popup img { max-width:100%; height:auto; margin-top:10px; border-radius:6px; display:block; }
  .close-btn { position:absolute; top:8px; right:10px; font-size:20px; cursor:pointer; border:none; background:transparent; }
  .controls { margin-top: 12px; color:#444; font-size:0.95rem; }
#quiz {
  display: flex;
  flex-wrap: wrap;          /* allows wrapping onto new lines */
  justify-content: flex-start;
  gap: 20px;                /* space between question boxes */
  margin-top: 30px;
  padding: 15px;
  background-color: #f9f9f9;
  border-radius: 10px;
  font-family: "Noto Sans JP", "Yu Gothic", sans-serif;
}

.question {
  flex: 1 1 200px;          /* each question box is about 200px wide but flexible */
  min-width: 180px;
  max-width: 250px;
  background: white;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 12px;
  text-align: center;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.question label {
  font-weight: bold;
  display: block;
  margin-bottom: 6px;
}

.question input {
  width: 80%;
  padding: 5px;
  font-size: 1em;
  margin-bottom: 8px;
}

.question button {
  display: block;           /* puts it below the input */
  width: 100%;
  padding: 6px 10px;
  font-size: 0.9em;
  border-radius: 5px;
  background-color: #e6f0ff;
  border: 1px solid #99bbff;
  cursor: pointer;
}

.question button:hover {
  background-color: #d0e0ff;
}

.question span {
  display: block;
  margin-top: 6px;
  font-weight: bold;
}

  .sentence {
  position: relative;
  padding-left: 12px; /* small space for the number */
  display: inline-block; /* allows relative positioning */
  margin-right: 6px; /* spacing between sentences */
  counter-increment: sentence-counter;
}

.sentence::before {
  content: counter(sentence-counter);
  font-size: 0.6em;
  position: absolute;
  left: 0px;
  top: -0.6em; /* moves number above the first character */
  color: #555;
}

body {
  counter-reset: sentence-counter;
}
</style>
</head>
<body>

<h2>おじぎ</h2>

<div class="instructions">
1. 次の文章（ぶんしょう）を読んで、下の１）〜７）の中から正（ただ）しい（correct）ものを選（えら）んでください。
</div>
  
<p>
  <!-- Examples: specify action + (for audio) data-audio + (for define) data-key -->
<span class="sentence">ミッシェルは、今日本に<span class="word audio" data-action="audio" data-audio="audio/ryuugaku.mp3">留学</span>しています。</span>
<span class="sentence">ホームステイをしていて、毎日<span class="word audio" data-action="audio" data-audio="audio/densha.mp3">電車</span>で大学に行っているので、日本のいろいろな<span class="word audio" data-action="audio" data-audio="audio/shyuukan.mp3">習慣</span>がわかってきました。</span>
<span class="sentence">ミッシェルが<span class="word audio" data-action="audio" data-audio="audio/ichiban.mp3">一番</span>おもしろいと思う<span class="word audio" data-action="audio" data-audio="audio/shyuukan.mp3">習慣</span>は、<span class="word define" data-action="define" data-key="おじぎ">おじぎ</span>です。</span>
<span class="sentence"><span class="word audio" data-action="audio" data-audio="audio/kazoku.mp3">家族</span>どうしが<span class="word define" data-action="define" data-key="おじぎ">おじぎ</span>をすることはありませんが、<span class="word define" data-action="define" data-key="げんかん">げんかん</span>にお<span class="word audio" data-action="audio" data-audio="audio/kyaku.mp3">客</span>さんが来たら、<span class="word define" data-action="define" data-key="おじぎ">おじぎ</span>をします。</span>
<span class="sentence"><span class="word audio" data-action="audio" data-audio="audio/soto.mp3">外</span>で<span class="word audio" data-action="audio" data-audio="audio/kinjyo.mp3">近所</span>の人に<span class="word audio" data-action="audio" data-audio="audio/atta.mp3">会った</span>時も<span class="word define" data-action="define" data-key="おじぎ">おじぎ</span>をします。</span>
<span class="sentence">大学のキャンパスで先生に会って、<span class="word define" data-action="define" data-key="おじぎ">おじぎ</span>をしないのは、とても<span class="word audio" data-action="audio" data-audio="audio/shitsuree.mp3">失礼</span>です。</span>
<span class="sentence">とてもおかしいのは、<span class="word define" data-action="define" data-key="こうしゅう電話">こうしゅう電話</span>で話している人が、電話で話している人に「どうもすみません」とか「どうもありがとうございました」などと言って、<span class="word define" data-action="define" data-key="おじぎ">おじぎ</span>をすることです。</span>
</p>
<p>
<span class="sentence">ミッシェルは、おじぎのことをもっとよく知りたいと思って、大学の<span class="word audio" data-action="audio" data-audio="audio/toshokan.mp3">図書館</span>で日本人の<span class="word audio" data-action="audio" data-audio="audio/shyuukan.mp3">習慣</span>を<span class="word audio" data-action="audio" data-audio="audio/setsumee.mp3">説明</span>している本を<span class="word audio" data-action="audio" data-audio="audio/karite.mp3">借りて</span>、おじぎについて読んでみました。</span>
<span class="sentence">本を読んで、<span class="word audio" data-action="audio" data-audio="audio/tsugi.mp3">次</span>のことがわかりました。</span>
<span class="sentence">まず、<span class="word audio" data-action="audio" data-audio="audio/meue.mp3">目上</span>の人と<span class="word audio" data-action="audio" data-audio="audio/meshita.mp3">目下</span>の人が<span class="word audio" data-action="audio" data-audio="audio/atta.mp3">会った</span>時、<span class="word audio" data-action="audio" data-audio="audio/meshita.mp3">目下</span>の人のほうが<span class="word audio" data-action="audio" data-audio="audio/hukai.mp3">深い</span>おじぎをしなくてはいけません。</span>
<span class="sentence"><span class="word audio" data-action="audio" data-audio="audio/jyosee.mp3">女性</span>と<span class="word audio" data-action="audio" data-audio="audio/dansee.mp3">男性</span>では、ふつう<span class="word audio" data-action="audio" data-audio="audio/jyosee.mp3">女性</span>のほうが<span class="word audio" data-action="audio" data-audio="audio/hukai.mp3">深い</span>おじぎをします。</span>
<span class="sentence">それから、おじぎは<span class="word audio" data-action="audio" data-audio="audio/chikaku.mp3">近く</span>にいる人だけにするものではありません。</span>
<span class="sentence"><span class="word audio" data-action="audio" data-audio="audio/tooku.mp3">遠く</span>に知っている人を見て、その人が友だちだったら、<span class="word define" data-action="define" data-key="手をふる">手をふる</span>だけでいいですが、その人が<span class="word audio" data-action="audio" data-audio="audio/meue.mp3">目上</span>の人だったら、<span class="word define" data-action="define" data-key="手をふる">手をふる</span>のではなくて、<span class="word audio" data-action="audio" data-audio="audio/atama.mp3">頭</span>を<span class="word audio" data-action="audio" data-audio="audio/sukoshi.mp3">少し</span><span class="word audio" data-action="audio" data-audio="audio/sageta.mp3">下げた</span>ほうがいいです。</span>
</p>
<p>
<span class="sentence">その本を読んでから、ミッシェルは『ローマでは、ローマ人がするようにしなさい（<span class="word audio" data-action="audio" data-audio="audio/goo.mp3">郷</span>に<span class="word audio" data-action="audio" data-audio="audio/itte.mp3">入って</span>は<span class="word audio" data-action="audio" data-audio="audio/goo.mp3">郷</span>にしたがえ）When in Rome, do as the Romans do.』という<span class="word define" data-action="define" data-key="ことわざ">ことわざ</span>を<span class="word audio" data-action="audio" data-audio="audio/omoidashite.mp3">思い出して</span>、日本人のようにおじぎをすることにしました。</span>
</p>

<div class="controls">
  Use Tab to focus a word and press Enter/Space to activate. Words colored blue = audio, orange = definition, blue+bold = both.
</div>

<!-- Popup for definitions -->
<div class="popup" id="popup" aria-hidden="true">
  <div class="popup-content" role="dialog" aria-modal="true" aria-labelledby="popup-title">
    <button class="close-btn" id="closePopup" aria-label="Close">&times;</button>
    <h2 id="popup-title"></h2>
    <p id="popup-definition"></p>
    <img id="popup-image" src="" alt="" />
  </div>
</div>

<div id="truefalse-section">

   <!-- Example TRUE/FALSE Item -->
  <div class="tf-question"
       data-answer="true"
       data-explanation="３文目をもう一度読みましょう(re-read the 3rd sentence of the passage)。"
       data-explanation-video="videos/exp1.mp4"
       data-translation="The custom that Michelle thinks is most interesting is bowing.">

    <p>1. ミッシェルは、日本のいろいろな習慣の中で、おじぎが一番おもしろいと思っている。</p>

    <!-- Choices -->
    <button onclick="checkTF(this, true)">○</button>
    <button onclick="checkTF(this, false)">×</button>

    <!-- Feedback -->
    <span class="tf-result"></span>

    <!-- Explanation button (hidden until answered) -->
    <button class="tf-detail-btn" style="display:none;" onclick="toggleDetail(this)">
      説明（せつめい）
    </button>

    <!-- Explanation image area (hidden until shown) -->
    <div class="tf-detail" style="display:none;">
      <video class="tf-video" controls style="max-width: 100%; margin-top: 10px; display:none;">
  Your browser does not support the video tag.
</video>
      <button class="tf-translation-btn" onclick="toggleTranslation(this)" style="display:none; margin-top: 8px;">
        英訳（えいやく）
      </button>
      <div class="tf-translation" style="display:none; margin-top: 8px;"></div>
    </div>

<div class="tf-question"
       data-answer="false"
       data-explanation="４文目をもう一度読みましょう(re-read the 4th sentence of the passage)。"
       data-explanation-video="videos/exp2.mp4"
       data-translation="Although there are no situations where family members bow to each other, if a guest comes to the front door, they bow.">

    <p>2. 日本では、家族どうしもおじぎをすることになっている。</p>
    <button onclick="checkTF(this, true)">○</button>
    <button onclick="checkTF(this, false)">×</button>
    <span class="tf-result"></span>
    <button class="tf-detail-btn" style="display:none;" onclick="toggleDetail(this)">
      説明（せつめい）
    </button>
    <div class="tf-detail" style="display:none;">
      <video class="tf-video" controls style="max-width: 100%; margin-top: 10px; display:none;">
  Your browser does not support the video tag.
</video>
      <button class="tf-translation-btn" onclick="toggleTranslation(this)" style="display:none; margin-top: 8px;">
        英訳（えいやく）
      </button>
      <div class="tf-translation" style="display:none; margin-top: 8px;"></div>
    </div>

<div class="tf-question"
       data-answer="true"
       data-explanation="７文目をもう一度読みましょう(re-read the 7th sentence of the passage)"
       data-explanation-video="videos/exp3.mp4"
       data-translation="The very strange thing is when a person who is talking on a payphone says things like "I'm sorry" and "Thank you very much" to the person they are talking to and bows.">

    <p>3. 日本人は、電話で話している時にもおじぎをする。</p>
    <button onclick="checkTF(this, true)">○</button>
    <button onclick="checkTF(this, false)">×</button>
    <span class="tf-result"></span>
    <button class="tf-detail-btn" style="display:none;" onclick="toggleDetail(this)">
      説明（せつめい）
    </button>
    <div class="tf-detail" style="display:none;">
      <video class="tf-video" controls style="max-width: 100%; margin-top: 10px; display:none;">
  Your browser does not support the video tag.
</video>
      <button class="tf-translation-btn" onclick="toggleTranslation(this)" style="display:none; margin-top: 8px;">
        英訳（えいやく）
      </button>
      <div class="tf-translation" style="display:none; margin-top: 8px;"></div>
    </div>

<div class="tf-question"
       data-answer="true"
       data-explanation="８文目をもう一度読みましょう(re-read the 8th sentence of the passage)"
       data-explanation-video="videos/exp4.mp4"
       data-translation="Michelle thought she wants to know more about bowing, so borrowed a book that explains Japanese people's customs at the university library and tried reading about bowing.">

    <p>4. ミッシェルが日本で勉強している大学の図書館には、日本人の習慣を説明している本がある。</p>

    <button onclick="checkTF(this, true)">○</button>
    <button onclick="checkTF(this, false)">×</button>
    <span class="tf-result"></span>
    <button class="tf-detail-btn" style="display:none;" onclick="toggleDetail(this)">
      説明（せつめい）
    </button>
    <div class="tf-detail" style="display:none;">
      <video class="tf-video" controls style="max-width: 100%; margin-top: 10px; display:none;">
  Your browser does not support the video tag.
</video>
      <button class="tf-translation-btn" onclick="toggleTranslation(this)" style="display:none; margin-top: 8px;">
        英訳（えいやく）
      </button>
      <div class="tf-translation" style="display:none; margin-top: 8px;"></div>
    </div>

<div class="tf-question"
       data-answer="true"
       data-explanation="１０文目をもう一度読みましょう(re-read the 10th sentence of the passage)"
       data-explanation-video="videos/exp5.mp4"
       data-translation="First of all, when a person of higher and lower social status meet, the person of lower status must bow lower.">

    <p>5. 目上の人と目下の人では、おじぎのしかた(way/manner)がちがう。</p>

    <button onclick="checkTF(this, true)">○</button>
    <button onclick="checkTF(this, false)">×</button>
    <span class="tf-result"></span>
    <button class="tf-detail-btn" style="display:none;" onclick="toggleDetail(this)">
      説明（せつめい）
    </button>
    <div class="tf-detail" style="display:none;">
      <video class="tf-video" controls style="max-width: 100%; margin-top: 10px; display:none;">
  Your browser does not support the video tag.
</video>
      <button class="tf-translation-btn" onclick="toggleTranslation(this)" style="display:none; margin-top: 8px;">
        英訳（えいやく）
      </button>
      <div class="tf-translation" style="display:none; margin-top: 8px;"></div>
    </div>

<div class="tf-question"
       data-answer="false"
       data-explanation="１３文目をもう一度読みましょう(re-read the 13th sentence of the passage)"
       data-explanation-video="videos/exp6.mp4"
       data-translation="Seeing someone you know afar, if they are a friend just waving is fine, but if that person is someone of higher status, you should lower your head a little instead of waving.">

    <p>6. 遠くにいる目上の人には、手をふるだけでいい。</p>

    <button onclick="checkTF(this, true)">○</button>
    <button onclick="checkTF(this, false)">×</button>
    <span class="tf-result"></span>
    <button class="tf-detail-btn" style="display:none;" onclick="toggleDetail(this)">
      説明（せつめい）
    </button>
    <div class="tf-detail" style="display:none;">
      <video class="tf-video" controls style="max-width: 100%; margin-top: 10px; display:none;">
  Your browser does not support the video tag.
</video>
      <button class="tf-translation-btn" onclick="toggleTranslation(this)" style="display:none; margin-top: 8px;">
        英訳（えいやく）
      </button>
      <div class="tf-translation" style="display:none; margin-top: 8px;"></div>
    </div>

<div class="tf-question"
       data-answer="false"
       data-explanation="１４文目をもう一度読みましょう(re-read the 14th sentence of the passage)"
       data-explanation-video="videos/exp7.mp4"
       data-translation="After reading that book, Michelle remembered the proverb "When in Rome, do as the Romans do" and decided to bow like Japanese people.">

    <p>7. ミッシェルは、今日本に住んでいるが、アメリカ人なので、日本人のようなおじぎはしないつもりだ。</p>

    <button onclick="checkTF(this, true)">○</button>
    <button onclick="checkTF(this, false)">×</button>
    <span class="tf-result"></span>
    <button class="tf-detail-btn" style="display:none;" onclick="toggleDetail(this)">
      説明（せつめい）
    </button>
    <div class="tf-detail" style="display:none;">
      <video class="tf-video" controls style="max-width: 100%; margin-top: 10px; display:none;">
  Your browser does not support the video tag.
</video>
      <button class="tf-translation-btn" onclick="toggleTranslation(this)" style="display:none; margin-top: 8px;">
        英訳（えいやく）
      </button>
      <div class="tf-translation" style="display:none; margin-top: 8px;"></div>
    </div>
  
<div class="instructions">
  2. 下の漢字の読み方を⬜︎の中にひらがなで書いてください。
</div>

<div id="quiz">

  <div class="question">
    <label>1) 留学</label><br>
    <input type="text" id="q1" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q1', 'りゅうがく')">check answer</button>
    <span id="result-q1"></span>
  </div>

  <div class="question">
    <label>2) 電車</label><br>
    <input type="text" id="q2" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q2', 'でんしゃ')">check answer</button>
    <span id="result-q2"></span>
  </div>

  <div class="question">
    <label>3) 習慣</label><br>
    <input type="text" id="q3" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q3', 'しゅうかん')">check answer</button>
    <span id="result-q3"></span>
  </div>

　<div class="question">
    <label>4) 一番</label><br>
    <input type="text" id="q4" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q4', 'いちばん')">check answer</button>
    <span id="result-q4"></span>
  </div>

　<div class="question">
    <label>5) 家族</label><br>
    <input type="text" id="q5" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q5', 'かぞく')">check answer</button>
    <span id="result-q5"></span>
  </div>

　<div class="question">
    <label>6) 客</label><br>
    <input type="text" id="q6" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q6', 'きゃく')">check answer</button>
    <span id="result-q6"></span>
  </div>

　<div class="question">
    <label>7) 外</label><br>
    <input type="text" id="q7" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q7', 'そと')">check answer</button>
    <span id="result-q7"></span>
  </div>

　<div class="question">
    <label>8) 近所</label><br>
    <input type="text" id="q8" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q8', 'きんじょ')">check answer</button>
    <span id="result-q8"></span>
  </div>

　<div class="question">
    <label>9) 会う</label><br>
    <input type="text" id="q9" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q9', 'あう')">check answer</button>
    <span id="result-q9"></span>
  </div>

　<div class="question">
    <label>10) 失礼</label><br>
    <input type="text" id="q10" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q10', 'しつれい')">check answer</button>
    <span id="result-q10"></span>
  </div>

　<div class="question">
    <label>11) 電話</label><br>
    <input type="text" id="q11" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q11', 'でんわ')">check answer</button>
    <span id="result-q11"></span>
  </div>

　<div class="question">
    <label>12) 話す</label><br>
    <input type="text" id="q12" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q12', 'はなす')">check answer</button>
    <span id="result-q12"></span>
  </div>

　<div class="question">
    <label>13) 知る</label><br>
    <input type="text" id="q13" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q13', 'しる')">check answer</button>
    <span id="result-q13"></span>
  </div>

　<div class="question">
    <label>14) 図書館</label><br>
    <input type="text" id="q14" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q14', 'としょかん')">check answer</button>
    <span id="result-q14"></span>
  </div>

　<div class="question">
    <label>15) 説明</label><br>
    <input type="text" id="q15" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q15', 'せつめい')">check answer</button>
    <span id="result-q15"></span>
  </div>

　<div class="question">
    <label>16) 借りる</label><br>
    <input type="text" id="q16" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q16', 'かりる')">check answer</button>
    <span id="result-q16"></span>
  </div>

　<div class="question">
    <label>17) 読む</label><br>
    <input type="text" id="q17" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q17', 'よむ')">check answer</button>
    <span id="result-q17"></span>
  </div>

　<div class="question">
    <label>18) 次</label><br>
    <input type="text" id="q18" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q18', 'つぎ')">check answer</button>
    <span id="result-q18"></span>
  </div>

　<div class="question">
    <label>19) 目上</label><br>
    <input type="text" id="q19" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q19', 'めうえ')">check answer</button>
    <span id="result-q19"></span>
  </div>

　<div class="question">
    <label>20) 目下</label><br>
    <input type="text" id="q20" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q20', 'めした')">check answer</button>
    <span id="result-q20"></span>
  </div>

　<div class="question">
    <label>21) 深い</label><br>
    <input type="text" id="q21" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q21', 'ふかい')">check answer</button>
    <span id="result-q21"></span>
  </div>

　　<div class="question">
    <label>22) 近い</label><br>
    <input type="text" id="q22" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q22', 'ちかい')">check answer</button>
    <span id="result-q22"></span>
  </div>

　　<div class="question">
    <label>23) 遠い</label><br>
    <input type="text" id="q23" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q23', 'とおい')">check answer</button>
    <span id="result-q23"></span>
  </div>

　　<div class="question">
    <label>24) 頭</label><br>
    <input type="text" id="q24" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q24', 'あたま')">check answer</button>
    <span id="result-q24"></span>
  </div>

　　<div class="question">
    <label>25) 少し</label><br>
    <input type="text" id="q25" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q25', 'すこし')">check answer</button>
    <span id="result-q25"></span>
  </div>

　　<div class="question">
    <label>26) 下げる</label><br>
    <input type="text" id="q26" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q26', 'さげる')">check answer</button>
    <span id="result-q26"></span>
  </div>

　　<div class="question">
    <label>27) 思い出す</label><br>
    <input type="text" id="q27" placeholder="ひらがなで入力"><br>
    <button onclick="checkAnswer('q27', 'おもいだす')">check answer</button>
    <span id="result-q27"></span>
  </div>
</div>

<script>
function checkTF(button, userChoice) {
  const container = button.closest(".tf-question");
  const correctAnswer = container.dataset.answer === "true";
  const explanation = container.dataset.explanation;
  const videoPath = container.dataset.explanationVideo;
  const translation = container.dataset.translation;

  const resultSpan = container.querySelector(".tf-result");
  const detailBtn = container.querySelector(".tf-detail-btn");
  const detailBox = container.querySelector(".tf-detail");
  const videoBox = container.querySelector(".tf-video");
  const translationBtn = container.querySelector(".tf-translation-btn");
  const translationBox = container.querySelector(".tf-translation");

  // Reset
  translationBox.style.display = "none";
  translationBtn.style.display = "none";
  videoBox.style.display = "none";

  // Correct / incorrect feedback
  if (userChoice === correctAnswer) {
    resultSpan.textContent = "✅ 正解（せいかい）(correct)";
    resultSpan.style.color = "green";
  } else {
    resultSpan.textContent = `❌ 不正解（ふせいかい）(incorrect): ${explanation}`;
    resultSpan.style.color = "red";
  }

  // Set video source
  if (videoPath) {
    videoBox.src = videoPath;
  }

  // Set translation text
  translationBox.textContent = translation;

  // Show 説明 button
  detailBtn.style.display = "inline-block";

  // Hide detail area if previously opened
  detailBox.style.display = "none";
}
  
function checkAnswer(inputId, correctAnswer) {
  const userInput = document.getElementById(inputId).value.trim();
  const resultSpan = document.getElementById("result-" + inputId);

  if (userInput === correctAnswer) {
    resultSpan.textContent = "✅ 正解（せいかい）！(Correct!)";
    resultSpan.style.color = "green";
  } else {
    resultSpan.textContent = `❌ 不正解（ふせいかい）(Incorrect): 正しい答えは「${correctAnswer}」です。`;
    resultSpan.style.color = "red";
  }
}
</script>

<script>
/* ---------- Data: definitions + image paths ---------- */
/* Add entries for words you want definitions for. Key should match data-key on <span>. */
const dictionary = {
  "おじぎ": {
    word: "おじぎ",
    definition: "Bowing.",
    image: "images/ojigi.jpg"
  },
  "こうしゅう電話": {
    word: "こうしゅう電話",
    definition: "Pay phone.",
    image: "images/denwa.jpg"
  },
  "ことわざ": {
    word: "ことわざ",
    definition: "Proverb.",
    image: "images/kotowaza.jpg"
  },
  "手をふる": {
    word: "手をふる",
    definition: "To wave.",
    image: "images/teohuru.jpg"
  },
  "げんかん": {
    word: "げんかん",
    definition: "Front door.",
    image: "images/genkan.jpg"
  }
};
/* ---------------------------------------------------- */

/* Utility: Stop all playing audio and remove playing highlight */
function stopAllPlaying() {
  document.querySelectorAll('.word.playing').forEach(el => el.classList.remove('playing'));
  // Pause any audio objects stored on elements
  document.querySelectorAll('.word').forEach(el => {
    if (el._audio) {
      try { el._audio.pause(); el._audio.currentTime = 0; } catch(e) {}
    }
  });
}

/* Handle popup (definition + image) */
const popup = document.getElementById('popup');
const popupTitle = document.getElementById('popup-title');
const popupDefinition = document.getElementById('popup-definition');
const popupImage = document.getElementById('popup-image');
const closePopup = document.getElementById('closePopup');

function showPopup(key) {
  const entry = dictionary[key];
  if (!entry) return;
  popupTitle.textContent = entry.word;
  popupDefinition.textContent = entry.definition;
  popupImage.src = entry.image || "";
  popupImage.alt = entry.image ? `Image illustrating ${entry.word}` : "";
  popup.style.display = 'flex';
  popup.setAttribute('aria-hidden', 'false');
  // trap focus to close button for simple accessibility
  closePopup.focus();
}
function hidePopup() {
  popup.style.display = 'none';
  popup.setAttribute('aria-hidden', 'true');
}

/* Close handlers */
closePopup.addEventListener('click', hidePopup);
popup.addEventListener('click', (e) => {
  if (e.target === popup) hidePopup(); // click outside content
});
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') hidePopup();
});

/* Main: wire up word elements */
document.querySelectorAll('.word').forEach(elem => {
  const action = elem.dataset.action || "";
  // Preload audio only if audio provided
  if ((action === 'audio' || action === 'both') && elem.dataset.audio) {
    const a = new Audio(elem.dataset.audio);
    elem._audio = a;
  }

  function activate() {
    const a = elem._audio;
    const key = (elem.dataset.key || "").toLowerCase();

    // If both or audio -> play audio
    if ((action === 'audio' || action === 'both') && a) {
      stopAllPlaying();
      elem.classList.add('playing');
      a.currentTime = 0;
      a.play().catch(err => { console.warn("audio play failed:", err); });
      a.onended = () => elem.classList.remove('playing');
    }

    // If define or both -> show popup if entry exists; else optional fallback
    if ((action === 'define' || action === 'both') && key) {
      if (dictionary[key]) {
        showPopup(key);
      } else {
        // Fallback: try browser TTS to read a short message
        const msg = `${key}. Definition not available.`;
        if ('speechSynthesis' in window) {
          speechSynthesis.cancel();
          const ut = new SpeechSynthesisUtterance(msg);
          speechSynthesis.speak(ut);
        } else {
          alert(msg);
        }
      }
    }
  }

  // click handler
  elem.addEventListener('click', activate);

  // keyboard activation (Enter or Space)
  elem.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      activate();
    }
  });
});

/* Accessibility: ensure focus outline on click for mouse users */
document.addEventListener('mousedown', () => {
  document.body.classList.add('using-mouse');
});
document.addEventListener('keydown', () => {
  document.body.classList.remove('using-mouse');
});
</script>
</body>
</html>
